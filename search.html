<!DOCTYPE html>
<html>
	<head>
		<!-- <HEAD> TEMPLATE -->
		<!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- CSS tags. nb: files relative to ./nav-redesign, not ./ -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="./vendor/font-awesome/css/font-awesome.min.css">
		</style>

		<!-- END TEMPLATE -->

		<title>Mentor Net</title>
	</head>
	<body>

		<header class="container pt-2 pb-0 bg-dark text-light">
			<h4 class="row mb-0">
				<a href="search.html" class="col-6 px-2 text-light">Mentor Net</a>
				<small class="text-right col px-2 mt-1">Find a Mentor</small>
			</h4>
		</header>

		<nav class="container pt-2 pb-0 bg-dark">
			<div class="row">
				<div class="col-6 px-2">
					<span class="btn btn-sm btn-warning w-100">
						<i class="fa fa-fw fa-search"></i> Learn
					</span>
				</div>
				<div class="col-6 px-2">
					<a href="profile.html" class="btn btn-sm btn-outline-warning w-100">
						<i class="fa fa-fw fa-user"></i> Profile
					</a>
				</div>
			</div>
		</nav>

		<div id="vue-entry" class="container">

			<div class="row">
				<div class="col-12 py-2 px-2 bg-dark sticky-top">
					<div class="input-group">
						<input
							v-model="searchInput"
							@input="updateListView"
							class="form-control form-control-sm w-50"
							type="text"
							placeholder="Search by topic or name" />
						<select class="custom-select custom-select-sm">
							<option value="now">Today</option>
							<option value="later" disabled>Later (Coming soon!)</option>
						</select>
					</div>
				</div>

				<div class="col-12 py-2">
					<small class="text-muted">AVAILABLE MENTORS</small>
					<!-- TODO: Build the link to the mentor booking -->
					<a :href="'#' + mentor.name"
						class="row border-top py-2"
						v-for="mentor in filteredMentors">
						<div class="col-3">
							{{ mentor.name }}
						</div>
						<div class="col-9 text-truncate">
							{{ mentor.skills.join(', ') }}
						</div>
					</a>
				</div>
			</div>

		</div>

		<!-- Javascript (global) -->
		<script src="https://cdn.jsdelivr.net/npm/vue"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<script src="./js/generics.js"></script>
		<script src="./js/fuzzysearch.js"></script>
		<script src="./js/session-data.js"></script>

		<!-- Javascript (local) -->
		<script>
			let pageData = {
				searchInput: '',

				mentors: [
					/* Expects { name, [skills], uid } */
				],
				filteredMentors: []
			};

			let vue = new Vue({
				el: '#vue-entry',
				data: pageData,
				methods: {
					updateListView () {
						this.filteredMentors = this.mentors.filter(mentor => {
							if (this.searchInput.length) {
								const hasSkill = mentor.skills.reduce((prev,skill) => {
									return prev || fuzzysearch(this.searchInput, skill) || fuzzysearch(this.searchInput, mentor.name);
								}, false);
								return hasSkill;
							}
							return true;
						});
					}
				}
			});

			vue.updateListView();

			// TODO: loading indicator UI while AJAX fetches mentors
			http.get('/mentors')
				.then(response => {
					vue.mentors = response.data;
				}).catch(err => {
					// TODO: show error on page
					handleAxiosError(err);
				});

		</script>

	</body>
</html>
